# è´¡çŒ®æŒ‡å—

æ„Ÿè°¢ä½ å¯¹äº‘åŸç”Ÿ DevOps å¹³å°é¡¹ç›®çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ã€‚

## è´¡çŒ®æ–¹å¼

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºé¡¹ç›®åšå‡ºè´¡çŒ®ï¼š

- ğŸ› æŠ¥å‘Š Bug
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè®®
- ğŸ“ æ”¹è¿›æ–‡æ¡£
- ğŸ”§ æäº¤ä»£ç ä¿®å¤
- â­ Star é¡¹ç›®å¹¶åˆ†äº«

## å¼€å‘ç¯å¢ƒå‡†å¤‡

### å‰ç½®è¦æ±‚

- Git
- Python 3.8+
- Ansible 2.9+
- åŸºæœ¬çš„ Linux ç³»ç»ŸçŸ¥è¯†
- ç†Ÿæ‚‰ Kubernetes å’Œ Docker

### ç¯å¢ƒæ­å»º

```bash
# 1. Fork å¹¶å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/cloud-native-devops-platform.git
cd cloud-native-devops-platform

# 2. åˆ›å»ºå¼€å‘åˆ†æ”¯
git checkout -b feature/your-feature-name

# 3. å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements-dev.txt  # å¦‚æœå­˜åœ¨

# 4. é…ç½®æµ‹è¯•ç¯å¢ƒ
cp inventory/single-node.yml.example inventory/single-node.yml
vim inventory/single-node.yml
```

## ä»£ç è§„èŒƒ

### Ansible Playbook è§„èŒƒ

1. **å‘½åè§„èŒƒ**
   ```yaml
   # ä½¿ç”¨æè¿°æ€§åç§°
   - name: å®‰è£…å¹¶é…ç½® Docker CE
     # ...
   
   # é¿å…ä½¿ç”¨
   - name: Install docker
     # ...
   ```

2. **ä»»åŠ¡ç»„ç»‡**
   ```yaml
   # ä½¿ç”¨ tags ç»„ç»‡ä»»åŠ¡
   - name: é…ç½®ç³»ç»Ÿå‚æ•°
     tags: [setup, system]
     # ...
   ```

3. **å˜é‡å‘½å**
   ```yaml
   # ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”
   cluster_network: "192.168.1.0/24"
   app_namespace: "production"
   
   # é¿å…ä½¿ç”¨é©¼å³°å‘½å
   clusterNetwork: "192.168.1.0/24"  # ä¸æ¨è
   ```

4. **æ¨¡æ¿æ–‡ä»¶**
   ```yaml
   # æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶ä½¿ç”¨ .j2 åç¼€
   templates/
   â”œâ”€â”€ nginx.conf.j2
   â”œâ”€â”€ prometheus.yml.j2
   â””â”€â”€ app-deployment.yaml.j2
   ```

### Shell è„šæœ¬è§„èŒƒ

1. **è„šæœ¬å¤´éƒ¨**
   ```bash
   #!/bin/bash
   
   # è„šæœ¬åç§°: deploy.sh
   # æè¿°: äº‘åŸç”Ÿ DevOps å¹³å°éƒ¨ç½²è„šæœ¬
   # ä½œè€…: Your Name
   # æ—¥æœŸ: 2024-01-01
   
   set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º
   set -o pipefail  # ç®¡é“å‘½ä»¤å¤±è´¥æ—¶é€€å‡º
   ```

2. **å‡½æ•°å®šä¹‰**
   ```bash
   # ä½¿ç”¨æè¿°æ€§å‡½æ•°å
   check_prerequisites() {
       # å‡½æ•°å®ç°
   }
   
   # æ·»åŠ å‡½æ•°æ³¨é‡Š
   # æ£€æŸ¥å¿…è¦çš„å‘½ä»¤æ˜¯å¦å­˜åœ¨
   # å‚æ•°: $1 - å‘½ä»¤åç§°
   check_command() {
       command -v "$1" &> /dev/null || {
           echo "Error: $1 not found"
           exit 1
       }
   }
   ```

3. **å˜é‡ä½¿ç”¨**
   ```bash
   # ä½¿ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºå¸¸é‡
   readonly LOG_DIR="/var/log/deployment"
   readonly CONFIG_FILE="ansible.cfg"
   
   # ä½¿ç”¨å°å†™å­—æ¯è¡¨ç¤ºå˜é‡
   deployment_mode="full"
   inventory_file="inventory/hosts.yml"
   ```

### YAML æ–‡ä»¶è§„èŒƒ

1. **ç¼©è¿›**: ä½¿ç”¨ 2 ä¸ªç©ºæ ¼
2. **å¼•å·**: å­—ç¬¦ä¸²å€¼ä½¿ç”¨åŒå¼•å·ï¼ˆé™¤éåŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼‰
3. **æ³¨é‡Š**: åœ¨å¤æ‚é…ç½®å‰æ·»åŠ æ³¨é‡Š

```yaml
# Kubernetes éƒ¨ç½²é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
  namespace: production
  # æ ‡ç­¾ç”¨äºé€‰æ‹©å™¨åŒ¹é…
  labels:
    app: web-app
    version: "v1.0.0"
spec:
  replicas: 3
```

## æäº¤è§„èŒƒ

### Commit Message æ ¼å¼

ä½¿ç”¨çº¦å®šå¼æäº¤ï¼ˆConventional Commitsï¼‰æ ¼å¼ï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

#### Type ç±»å‹

- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·é“¾æ›´æ–°

#### ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½
feat(monitoring): æ·»åŠ  Grafana è‡ªå®šä¹‰é¢æ¿

æ·»åŠ äº†ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿ï¼ŒåŒ…æ‹¬ï¼š
- CPU ä½¿ç”¨ç‡è¶‹åŠ¿å›¾
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- ç£ç›˜ I/O ç»Ÿè®¡

# Bug ä¿®å¤
fix(kubernetes): ä¿®å¤èŠ‚ç‚¹åŠ å…¥å¤±è´¥çš„é—®é¢˜

ä¿®å¤äº†åœ¨ CentOS 9 ä¸Š worker èŠ‚ç‚¹åŠ å…¥é›†ç¾¤å¤±è´¥çš„é—®é¢˜
- æ›´æ–°äº† kubeadm é…ç½®
- ä¿®å¤äº†ç½‘ç»œæ’ä»¶å†²çª

Closes #123

# æ–‡æ¡£æ›´æ–°
docs(readme): æ›´æ–°å¿«é€Ÿå¼€å§‹æŒ‡å—

è¡¥å……äº†å•èŠ‚ç‚¹éƒ¨ç½²çš„è¯¦ç»†æ­¥éª¤
```

### æäº¤æµç¨‹

```bash
# 1. ç¡®ä¿åœ¨æœ€æ–°çš„ main åˆ†æ”¯ä¸Š
git checkout main
git pull origin main

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feat/add-monitoring-dashboard

# 3. è¿›è¡Œä¿®æ”¹å¹¶æµ‹è¯•
# ... ä½ çš„ä¿®æ”¹ ...

# 4. æš‚å­˜å¹¶æäº¤
git add .
git commit -m "feat(monitoring): æ·»åŠ  Grafana è‡ªå®šä¹‰é¢æ¿"

# 5. æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin feat/add-monitoring-dashboard

# 6. åœ¨ GitHub ä¸Šåˆ›å»º Pull Request
```

## Pull Request æµç¨‹

### åˆ›å»º PR

1. **ç¡®ä¿ä»£ç è´¨é‡**
   - ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
   - é€šè¿‡æ‰€æœ‰æµ‹è¯•
   - æ–‡æ¡£å·²æ›´æ–°

2. **PR æ ‡é¢˜**
   ```
   feat(monitoring): æ·»åŠ  Grafana è‡ªå®šä¹‰é¢æ¿
   ```

3. **PR æè¿°æ¨¡æ¿**
   ```markdown
   ## å˜æ›´ç±»å‹
   - [ ] Bug ä¿®å¤
   - [x] æ–°åŠŸèƒ½
   - [ ] æ–‡æ¡£æ›´æ–°
   - [ ] ä»£ç é‡æ„
   
   ## å˜æ›´è¯´æ˜
   æ·»åŠ äº†æ–°çš„ Grafana ç›‘æ§é¢æ¿ï¼Œç”¨äºå±•ç¤ºç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µã€‚
   
   ## æµ‹è¯•
   - [x] æœ¬åœ°æµ‹è¯•é€šè¿‡
   - [x] å•èŠ‚ç‚¹ç¯å¢ƒæµ‹è¯•
   - [ ] å¤šèŠ‚ç‚¹ç¯å¢ƒæµ‹è¯•
   
   ## ç›¸å…³ Issue
   Closes #123
   
   ## æˆªå›¾ï¼ˆå¦‚é€‚ç”¨ï¼‰
   ![ç›‘æ§é¢æ¿](screenshot.png)
   
   ## æ£€æŸ¥æ¸…å•
   - [x] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
   - [x] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š
   - [x] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
   - [x] é€šè¿‡äº†æ‰€æœ‰æµ‹è¯•
   ```

### Review æµç¨‹

1. **ç­‰å¾… Review**: ç»´æŠ¤è€…ä¼š review ä½ çš„ä»£ç 
2. **ä¿®æ”¹åé¦ˆ**: æ ¹æ®åé¦ˆä¿®æ”¹ä»£ç 
3. **é€šè¿‡å®¡æ ¸**: ä»£ç è¢«åˆå¹¶åˆ°ä¸»åˆ†æ”¯

## æµ‹è¯•æŒ‡å—

### æœ¬åœ°æµ‹è¯•

```bash
# 1. è¯­æ³•æ£€æŸ¥
ansible-playbook --syntax-check site.yml

# 2. æ£€æŸ¥æ¨¡å¼ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
./deploy.sh --check

# 3. é™åˆ¶ä¸»æœºæµ‹è¯•
./deploy.sh --limit test-node

# 4. è¿è¡ŒéªŒè¯è„šæœ¬
./scripts/quick-verify.sh
```

### æµ‹è¯•æ¸…å•

åœ¨æäº¤ PR å‰ï¼Œç¡®ä¿ï¼š

- [ ] Ansible playbook è¯­æ³•æ­£ç¡®
- [ ] æ‰€æœ‰è„šæœ¬å¯æ‰§è¡Œ
- [ ] æ–‡æ¡£é“¾æ¥æœ‰æ•ˆ
- [ ] ç¤ºä¾‹é…ç½®å¯ç”¨
- [ ] åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é€šè¿‡

## æŠ¥å‘Šé—®é¢˜

### Bug æŠ¥å‘Š

ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿æŠ¥å‘Š Bugï¼š

```markdown
## Bug æè¿°
ç®€è¦æè¿°é—®é¢˜

## é‡ç°æ­¥éª¤
1. æ‰§è¡Œå‘½ä»¤ `./deploy.sh --mode full`
2. åœ¨æ­¥éª¤ X å¤±è´¥
3. æŠ¥é”™ä¿¡æ¯ï¼š...

## æœŸæœ›è¡Œä¸º
æè¿°ä½ æœŸæœ›çš„æ­£ç¡®è¡Œä¸º

## å®é™…è¡Œä¸º
æè¿°å®é™…å‘ç”Ÿçš„æƒ…å†µ

## ç¯å¢ƒä¿¡æ¯
- OS: CentOS 9
- Ansible ç‰ˆæœ¬: 2.9.27
- Python ç‰ˆæœ¬: 3.9.7
- éƒ¨ç½²æ¨¡å¼: full

## æ—¥å¿—
```bash
# ç²˜è´´ç›¸å…³æ—¥å¿—
```

## å…¶ä»–ä¿¡æ¯
æ·»åŠ ä»»ä½•å…¶ä»–æœ‰åŠ©äºè§£å†³é—®é¢˜çš„ä¿¡æ¯
```

### åŠŸèƒ½è¯·æ±‚

```markdown
## åŠŸèƒ½æè¿°
æ¸…æ¥šåœ°æè¿°ä½ æƒ³è¦çš„åŠŸèƒ½

## ä½¿ç”¨åœºæ™¯
æè¿°è¿™ä¸ªåŠŸèƒ½çš„ä½¿ç”¨åœºæ™¯å’Œä¸ºä»€ä¹ˆéœ€è¦å®ƒ

## å»ºè®®çš„å®ç°æ–¹å¼
å¦‚æœæœ‰ï¼Œæè¿°ä½ å»ºè®®çš„å®ç°æ–¹å¼

## æ›¿ä»£æ–¹æ¡ˆ
æè¿°ä½ è€ƒè™‘è¿‡çš„æ›¿ä»£æ–¹æ¡ˆ

## å…¶ä»–ä¿¡æ¯
æ·»åŠ ä»»ä½•å…¶ä»–ç›¸å…³ä¿¡æ¯
```

## ä»£ç å®¡æŸ¥æŒ‡å—

### å®¡æŸ¥è€…å…³æ³¨ç‚¹

1. **åŠŸèƒ½æ€§**: ä»£ç æ˜¯å¦å®ç°äº†é¢„æœŸåŠŸèƒ½
2. **å¯ç»´æŠ¤æ€§**: ä»£ç æ˜¯å¦æ˜“äºç†è§£å’Œç»´æŠ¤
3. **æ€§èƒ½**: æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜
4. **å®‰å…¨æ€§**: æ˜¯å¦å­˜åœ¨å®‰å…¨éšæ‚£
5. **æµ‹è¯•**: æ˜¯å¦æœ‰å……è¶³çš„æµ‹è¯•

### å®¡æŸ¥è¯„è®ºç¤ºä¾‹

```markdown
# å»ºè®®æ”¹è¿›
è¿™é‡Œå»ºè®®ä½¿ç”¨å¾ªç¯æ¥ç®€åŒ–ä»£ç ï¼š
â€‹```yaml
- name: å®‰è£…è½¯ä»¶åŒ…
  yum:
    name: "{{ item }}"
    state: present
  loop:
    - docker-ce
    - kubelet
    - kubeadm
â€‹```

# è¯¢é—®é—®é¢˜
ä¸ºä»€ä¹ˆè¿™é‡Œé€‰æ‹©ä½¿ç”¨è¿™ç§å®ç°æ–¹å¼ï¼Ÿæœ‰è€ƒè™‘è¿‡ X æ–¹æ¡ˆå—ï¼Ÿ

# ç§°èµå¥½çš„å®ç°
è¿™ä¸ªé”™è¯¯å¤„ç†å†™å¾—å¾ˆå¥½ï¼ğŸ‘
```

## æ–‡æ¡£è´¡çŒ®

### æ–‡æ¡£ç±»å‹

- **æŠ€æœ¯æ–‡æ¡£**: æŠ€æœ¯å®ç°ç»†èŠ‚
- **ç”¨æˆ·æŒ‡å—**: é¢å‘ç”¨æˆ·çš„ä½¿ç”¨è¯´æ˜
- **API æ–‡æ¡£**: æ¥å£æ–‡æ¡£
- **é—®é¢˜æ’æŸ¥**: å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

### æ–‡æ¡£è§„èŒƒ

1. **ä½¿ç”¨ Markdown æ ¼å¼**
2. **æ·»åŠ ç›®å½•ç´¢å¼•**ï¼ˆå¯¹äºé•¿æ–‡æ¡£ï¼‰
3. **åŒ…å«ä»£ç ç¤ºä¾‹**
4. **ä½¿ç”¨å›¾è¡¨è¯´æ˜**ï¼ˆå¦‚é€‚ç”¨ï¼‰
5. **ä¿æŒæ›´æ–°**

### æ–‡æ¡£æ¨¡æ¿

```markdown
# æ ‡é¢˜

## æ¦‚è¿°
ç®€è¦è¯´æ˜æ–‡æ¡£å†…å®¹

## å‰ç½®æ¡ä»¶
åˆ—å‡ºå¿…è¦çš„å‰ç½®æ¡ä»¶

## æ­¥éª¤
### 1. ç¬¬ä¸€æ­¥
æè¿°å’Œç¤ºä¾‹ä»£ç 

### 2. ç¬¬äºŒæ­¥
æè¿°å’Œç¤ºä¾‹ä»£ç 

## éªŒè¯
å¦‚ä½•éªŒè¯æ“ä½œæˆåŠŸ

## æ•…éšœæ’é™¤
å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

## ç›¸å…³æ–‡æ¡£
é“¾æ¥åˆ°ç›¸å…³æ–‡æ¡£
```

## å‘å¸ƒæµç¨‹

### ç‰ˆæœ¬å·è§„èŒƒ

éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰ï¼š

```
MAJOR.MINOR.PATCH

1.0.0 -> 1.0.1 (Bug ä¿®å¤)
1.0.1 -> 1.1.0 (æ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹)
1.1.0 -> 2.0.0 (é‡å¤§å˜æ›´ï¼Œä¸å‘åå…¼å®¹)
```

### å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] CHANGELOG å·²æ›´æ–°
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–°
- [ ] åˆ›å»º Release Tag
- [ ] å‘å¸ƒ Release Notes

## ç¤¾åŒºå‡†åˆ™

### è¡Œä¸ºå‡†åˆ™

1. **å°Šé‡ä»–äºº**: å°Šé‡æ‰€æœ‰è´¡çŒ®è€…
2. **å»ºè®¾æ€§åé¦ˆ**: æä¾›æœ‰å»ºè®¾æ€§çš„åé¦ˆ
3. **åŒ…å®¹æ€§**: æ¬¢è¿ä¸åŒèƒŒæ™¯çš„è´¡çŒ®è€…
4. **è€å¿ƒ**: å¯¹æ–°æ‰‹ä¿æŒè€å¿ƒ

### æ²Ÿé€šæ¸ é“

- **GitHub Issues**: é—®é¢˜è®¨è®ºå’ŒåŠŸèƒ½è¯·æ±‚
- **Pull Requests**: ä»£ç å®¡æŸ¥å’Œè®¨è®º
- **Discussions**: ä¸€èˆ¬æ€§è®¨è®º
- **Email**: è”ç³»ç»´æŠ¤è€…

## èµ„æºé“¾æ¥

- [Ansible æœ€ä½³å®è·µ](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html)
- [Kubernetes æ–‡æ¡£](https://kubernetes.io/docs/)
- [çº¦å®šå¼æäº¤è§„èŒƒ](https://www.conventionalcommits.org/)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/)

## è®¸å¯è¯

è´¡çŒ®ä»£ç å³è¡¨ç¤ºä½ åŒæ„å°†ä»£ç ä»¥é¡¹ç›®çš„ MIT è®¸å¯è¯å‘å¸ƒã€‚

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºé¡¹ç›®åšå‡ºè´¡çŒ®çš„äººï¼

---

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿é€šè¿‡ Issues è”ç³»æˆ‘ä»¬ã€‚

