apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ app_name }}-config
  namespace: {{ app_namespace }}
data:
  nginx.conf: |
    worker_processes auto;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;

    events {
        worker_connections 1024;
    }

    http {
        log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                        '$status $body_bytes_sent "$http_referer" '
                        '"$http_user_agent" "$http_x_forwarded_for"';

        access_log /var/log/nginx/access.log main;

        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;

        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        server {
            listen 8080;
            server_name {{ app_domain }};
            root /usr/share/nginx/html;
            index index.html;

            location / {
                try_files $uri $uri/ /index.html;
            }

            location /health {
                access_log off;
                return 200 "healthy\n";
                add_header Content-Type text/plain;
            }

            location /ready {
                access_log off;
                return 200 "ready\n";
                add_header Content-Type text/plain;
            }
        }
    }
  index.html: |
    <!DOCTYPE html>
    <html>
    <head>
        <title>äº‘åŸç”ŸDevOpså¹³å°</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
            .container { max-width: 800px; margin: 0 auto; text-align: center; }
            h1 { font-size: 3em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
            .info { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0; }
            .status { display: inline-block; padding: 10px 20px; margin: 10px; background: rgba(0,255,0,0.3); border-radius: 5px; }
            .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
            .metric { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸš€ äº‘åŸç”ŸDevOpså¹³å°</h1>
            <div class="info">
                <h2>ç³»ç»ŸçŠ¶æ€</h2>
                <div class="status">âœ… è¿è¡Œæ­£å¸¸</div>
                <div class="status">ğŸ”§ è‡ªåŠ¨æ‰©ç¼©å®¹</div>
                <div class="status">ğŸ“Š ç›‘æ§å‘Šè­¦</div>
                <div class="status">ğŸ”„ CI/CDæµæ°´çº¿</div>
            </div>
            <div class="metrics">
                <div class="metric">
                    <h3>Kubernetesé›†ç¾¤</h3>
                    <p>èŠ‚ç‚¹æ•°: {{ app_replicas }}</p>
                    <p>çŠ¶æ€: å¥åº·</p>
                </div>
                <div class="metric">
                    <h3>ç›‘æ§ç³»ç»Ÿ</h3>
                    <p>Prometheus: è¿è¡Œä¸­</p>
                    <p>Grafana: è¿è¡Œä¸­</p>
                </div>
                <div class="metric">
                    <h3>CI/CD</h3>
                    <p>GitLab: è¿è¡Œä¸­</p>
                    <p>Jenkins: è¿è¡Œä¸­</p>
                </div>
                <div class="metric">
                    <h3>å­˜å‚¨</h3>
                    <p>ç±»å‹: æœ¬åœ°å­˜å‚¨</p>
                    <p>çŠ¶æ€: æ­£å¸¸</p>
                </div>
            </div>
            <div class="info">
                <h3>è®¿é—®åœ°å€</h3>
                <p>åº”ç”¨åœ°å€: http://{{ app_domain }}</p>
                <p>ç›‘æ§åœ°å€: http://{{ ansible_default_ipv4.address }}:{{ prometheus_port }}</p>
                <p>ä»ªè¡¨æ¿: http://{{ ansible_default_ipv4.address }}:{{ grafana_port }}</p>
            </div>
        </div>
        </body>
    </html>
